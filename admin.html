<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¦ç®¡ç†åå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            padding: 15px;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .tab-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            position: relative;
        }
        
        .tab-btn.active {
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #3498db;
        }
        
        .blessing-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .blessing-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .blessing-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .blessing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .blessing-username {
            font-weight: bold;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .blessing-time {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .blessing-content {
            font-size: 16px;
            line-height: 1.6;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .blessing-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>âš™ï¸</span> 
            ç¥ç¦ç®¡ç†åå°
            <span style="font-size: 14px; color: #ecf0f1; margin-left: 10px;">
                å®æ—¶æ¥æ”¶ç”¨æˆ·æäº¤
            </span>
        </h1>
        <div>
            <button class="btn btn-primary" onclick="location.href='display.html'">
                æŸ¥çœ‹å¤§å±
            </button>
            <button class="btn btn-warning" onclick="syncData()">
                æ‰‹åŠ¨åŒæ­¥
            </button>
        </div>
    </div>
    
    <div class="control-bar">
        <button class="btn btn-success" onclick="approveAllPending()">
            ä¸€é”®é€šè¿‡æ‰€æœ‰å¾…å®¡æ ¸
        </button>
        <button class="btn btn-danger" onclick="rejectAllPending()">
            ä¸€é”®æ‹’ç»æ‰€æœ‰å¾…å®¡æ ¸
        </button>
        <button class="btn" onclick="clearAllData()" style="background: #95a5a6; color: white;">
            æ¸…ç©ºæ‰€æœ‰æ•°æ®
        </button>
        <div style="flex: 1; text-align: right; color: #7f8c8d; font-size: 14px;">
            æœ€ååŒæ­¥: <span id="last-sync">åˆšåˆš</span>
            <span id="sync-indicator" style="margin-left: 10px;">ğŸŸ¢</span>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <div>æ€»ç¥ç¦æ•°</div>
            <div class="stat-number stat-total" id="stat-total">0</div>
        </div>
        <div class="stat-item">
            <div>å¾…å®¡æ ¸</div>
            <div class="stat-number stat-pending" id="stat-pending">0</div>
        </div>
        <div class="stat-item">
            <div>å·²é€šè¿‡</div>
            <div class="stat-number stat-approved" id="stat-approved">0</div>
        </div>
        <div class="stat-item">
            <div>å·²æ‹’ç»</div>
            <div class="stat-number stat-rejected" id="stat-rejected">0</div>
        </div>
    </div>
    
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('pending')">
                å¾…å®¡æ ¸ <span class="tab-badge" id="pending-count">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('approved')">
                å·²é€šè¿‡ <span id="approved-count">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('rejected')">
                å·²æ‹’ç» <span id="rejected-count">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('all')">
                å…¨éƒ¨ç¥ç¦
            </button>
        </div>
        
        <div class="tab-content">
            <div class="blessing-list" id="blessing-list">
                <!-- ç¥ç¦åˆ—è¡¨ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                <div class="empty-state" id="empty-state">
                    <div class="icon">ğŸ“­</div>
                    <h3>æš‚æ— æ•°æ®</h3>
                    <p>ç­‰å¾…ç”¨æˆ·æäº¤ç¥ç¦...</p>
                    <p style="font-size: 12px; margin-top: 10px;">
                        ç”¨æˆ·æäº¤åï¼Œæ•°æ®ä¼šè‡ªåŠ¨å‡ºç°åœ¨è¿™é‡Œ
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        æ”¶åˆ°æ–°çš„ç¥ç¦æäº¤ï¼
    </div>
    
    <div class="sync-status" id="sync-status">
        æ­£åœ¨åŒæ­¥æ•°æ®...
    </div>

 <script>
        // ç›¸åŒçš„GitHubé…ç½®
        const GITHUB_CONFIG = {
            USERNAME: 'xc-xiaoqiao',
            REPO: 'blessings-wall',
            BRANCH: 'main',
            TOKEN: ''
        };
        
        const API_URLS = {
            SUBMISSIONS: `https://api.github.com/repos/${GITHUB_CONFIG.USERNAME}/${GITHUB_CONFIG.REPO}/contents/data/submissions.json`,
            APPROVED: `https://api.github.com/repos/${GITHUB_CONFIG.USERNAME}/${GITHUB_CONFIG.REPO}/contents/data/approved.json`
        };
        
        let submissions = [];
        let approved = [];
        
        // åˆå§‹åŒ–
        async function init() {
            await loadData();
            renderBlessings();
            
            // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(loadData, 10000);
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                submissions = await fetchFromGitHub('SUBMISSIONS');
                approved = await fetchFromGitHub('APPROVED');
                updateStats();
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ‰¹å‡†ç¥ç¦
        async function approveBlessing(id) {
            const blessing = submissions.find(b => b.id === id);
            if (!blessing) return;
            
            // ä»å¾…å®¡æ ¸ç§»é™¤
            submissions = submissions.filter(b => b.id !== id);
            
            // æ·»åŠ åˆ°å·²æ‰¹å‡†
            blessing.status = 'approved';
            approved.push(blessing);
            
            // æ›´æ–°ä¸¤ä¸ªæ–‡ä»¶
            await updateGitHubFile('SUBMISSIONS', submissions);
            await updateGitHubFile('APPROVED', approved);
            
            // é‡æ–°æ¸²æŸ“
            renderBlessings();
            updateStats();
            showNotification('ç¥ç¦å·²æ‰¹å‡†');
        }
        
        // æ‹’ç»ç¥ç¦
        async function rejectBlessing(id) {
            submissions = submissions.filter(b => b.id !== id);
            await updateGitHubFile('SUBMISSIONS', submissions);
            renderBlessings();
            updateStats();
            showNotification('ç¥ç¦å·²æ‹’ç»');
        }
        
        // è¾…åŠ©å‡½æ•°ï¼ˆä¸index.htmlç›¸åŒï¼‰
        async function fetchFromGitHub(type) {
            try {
                const response = await fetch(API_URLS[type], {
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                const data = await response.json();
                if (data.content) {
                    return JSON.parse(atob(data.content));
                }
                return [];
            } catch (error) {
                console.error('è·å–å¤±è´¥:', error);
                return [];
            }
        }
        
        async function updateGitHubFile(type, content) {
            // è·å–SHA
            const getResponse = await fetch(API_URLS[type], {
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            const fileInfo = await getResponse.json();
            
            // æ›´æ–°æ–‡ä»¶
            await fetch(API_URLS[type], {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: `Update ${type}`,
                    content: btoa(JSON.stringify(content, null, 2)),
                    sha: fileInfo.sha,
                    branch: GITHUB_CONFIG.BRANCH
                })
            });
        }
        
               // å½“å‰æ ‡ç­¾é¡µ
        let currentTab = 'pending';
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            currentTab = tabName;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderBlessings();
        }
        
        // æ¸²æŸ“ç¥ç¦åˆ—è¡¨
        function renderBlessings() {
            let filtered = [];
            
            switch(currentTab) {
                case 'pending':
                    filtered = submissions.filter(b => b.status === 'pending');
                    break;
                case 'approved':
                    filtered = approved;
                    break;
                case 'rejected':
                    filtered = submissions.filter(b => b.status === 'rejected');
                    break;
                case 'all':
                    filtered = [...submissions, ...approved];
                    break;
            }
            
            const container = document.getElementById('blessing-list');
            const emptyState = document.getElementById('empty-state');
            
            if (filtered.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            filtered.forEach(blessing => {
                const item = document.createElement('div');
                item.className = 'blessing-item';
                item.dataset.id = blessing.id;
                
                const statusClass = `status-${blessing.status || 'pending'}`;
                const statusText = blessing.status === 'pending' ? 'å¾…å®¡æ ¸' : 
                                  blessing.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»';
                
                item.innerHTML = `
                    <div class="blessing-header">
                        <div class="blessing-username" style="color: ${blessing.color || '#2c3e50'}">
                            ğŸ‘¤ ${blessing.username}
                        </div>
                        <div>
                            <span class="blessing-time">${blessing.time || 'åˆšåˆš'}</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    
                    <div class="blessing-content">
                        ${blessing.text}
                    </div>
                    
                    <div class="blessing-actions">
                        ${blessing.status === 'pending' ? `
                            <button class="btn btn-success" onclick="approveBlessing('${blessing.id}')">
                                é€šè¿‡
                            </button>
                            <button class="btn btn-danger" onclick="rejectBlessing('${blessing.id}')">
                                æ‹’ç»
                            </button>
                        ` : ''}
                        
                        ${blessing.status === 'approved' ? `
                            <button class="btn btn-warning" onclick="rejectApproved('${blessing.id}')">
                                æ’¤å›é€šè¿‡
                            </button>
                        ` : ''}
                        
                        <button class="btn" onclick="deleteBlessing('${blessing.id}')" 
                                style="background: #95a5a6; color: white;">
                            åˆ é™¤
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // æ’¤å›å·²æ‰¹å‡†çš„ç¥ç¦
        async function rejectApproved(id) {
            approved = approved.filter(b => b.id !== id);
            await updateGitHubFile('APPROVED', approved);
            renderBlessings();
            updateStats();
            showNotification('å·²æ’¤å›ç¥ç¦');
        }
        
        // åˆ é™¤ç¥ç¦
        async function deleteBlessing(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¥ç¦å—ï¼Ÿ')) {
                submissions = submissions.filter(b => b.id !== id);
                approved = approved.filter(b => b.id !== id);
                
                await updateGitHubFile('SUBMISSIONS', submissions);
                await updateGitHubFile('APPROVED', approved);
                
                renderBlessings();
                updateStats();
                showNotification('ç¥ç¦å·²åˆ é™¤');
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            const total = submissions.length + approved.length;
            const pending = submissions.filter(b => b.status === 'pending').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-approved').textContent = approved.length;
            document.getElementById('stat-rejected').textContent = submissions.filter(b => b.status === 'rejected').length;
            
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('approved-count').textContent = approved.length;
            document.getElementById('rejected-count').textContent = submissions.filter(b => b.status === 'rejected').length;
        }
        
        // ä¸€é”®é€šè¿‡æ‰€æœ‰å¾…å®¡æ ¸
        async function approveAllPending() {
            const pending = submissions.filter(b => b.status === 'pending');
            if (pending.length === 0) {
                showNotification('æ²¡æœ‰å¾…å®¡æ ¸çš„ç¥ç¦');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦é€šè¿‡æ‰€æœ‰ ${pending.length} æ¡å¾…å®¡æ ¸ç¥ç¦å—ï¼Ÿ`)) {
                // æ·»åŠ åˆ°å·²æ‰¹å‡†
                pending.forEach(b => b.status = 'approved');
                approved.push(...pending);
                
                // ä»å¾…å®¡æ ¸ç§»é™¤
                submissions = submissions.filter(b => b.status !== 'pending');
                
                await updateGitHubFile('SUBMISSIONS', submissions);
                await updateGitHubFile('APPROVED', approved);
                
                renderBlessings();
                updateStats();
                showNotification(`å·²é€šè¿‡ ${pending.length} æ¡ç¥ç¦`);
            }
        }
        
        // ä¸€é”®æ‹’ç»æ‰€æœ‰å¾…å®¡æ ¸
        async function rejectAllPending() {
            const pending = submissions.filter(b => b.status === 'pending');
            if (pending.length === 0) {
                showNotification('æ²¡æœ‰å¾…å®¡æ ¸çš„ç¥ç¦');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ‹’ç»æ‰€æœ‰ ${pending.length} æ¡å¾…å®¡æ ¸ç¥ç¦å—ï¼Ÿ`)) {
                // æ ‡è®°ä¸ºæ‹’ç»
                pending.forEach(b => b.status = 'rejected');
                
                await updateGitHubFile('SUBMISSIONS', submissions);
                
                renderBlessings();
                updateStats();
                showNotification(`å·²æ‹’ç» ${pending.length} æ¡ç¥ç¦`);
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        async function clearAllData() {
            if (confirm('âš ï¸ è­¦å‘Šï¼è¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·æäº¤å’Œç®¡ç†å‘˜å®¡æ ¸è®°å½•ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                submissions = [];
                approved = [];
                
                await updateGitHubFile('SUBMISSIONS', []);
                await updateGitHubFile('APPROVED', []);
                
                renderBlessings();
                updateStats();
                showNotification('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®');
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // ä¿®æ”¹ loadData å‡½æ•°è°ƒç”¨ renderBlessings
        async function loadData() {
            try {
                submissions = await fetchFromGitHub('SUBMISSIONS');
                approved = await fetchFromGitHub('APPROVED');
                updateStats();
                renderBlessings();  // æ·»åŠ è¿™è¡Œ
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
        
        window.onload = init;
    </script>
</body>
</html>