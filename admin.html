<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - ç¥ç¦å¢™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            color: #1a202c;
        }
        
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .auth-box h1 {
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .auth-box p {
            color: #718096;
            margin-bottom: 30px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .admin-content {
            display: none;
        }
        
        .header {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 25px;
        }
        
        .main-content {
            flex: 1;
            padding: 25px;
            overflow: auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #718096;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .tab-nav {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 18px;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: #718096;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .blessing-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .blessing-item {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .blessing-item:hover {
            background: #f8fafc;
        }
        
        .blessing-content {
            flex: 1;
        }
        
        .blessing-text {
            font-size: 16px;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .blessing-meta {
            font-size: 13px;
            color: #718096;
        }
        
        .blessing-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-approve {
            background: #48bb78;
            color: white;
        }
        
        .btn-reject {
            background: #f56565;
            color: white;
        }
        
        .btn-delete {
            background: #ed8936;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-pending {
            background: #feebc8;
            color: #c05621;
        }
        
        .status-approved {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-rejected {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- å¯†ç éªŒè¯ç•Œé¢ -->
    <div class="auth-screen" id="auth-screen">
        <div class="auth-box">
            <h1>ğŸ” ç®¡ç†å‘˜ç™»å½•</h1>
            <p>è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥è®¿é—®æ§åˆ¶é¢æ¿</p>
            <input type="password" id="password-input" class="password-input" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <button class="btn btn-primary action-btn" onclick="checkPassword()">è¿›å…¥ç®¡ç†åå°</button>
            <p style="margin-top: 20px; font-size: 14px; color: #a0aec0;">
                å¿˜è®°å¯†ç ï¼Ÿè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜
            </p>
        </div>
    </div>
    
    <!-- ç®¡ç†ç•Œé¢ -->
    <div class="admin-content" id="admin-content">
        <div class="header">
            <h1><span>âš™ï¸</span> ç¥ç¦å¢™ç®¡ç†åå°</h1>
            <div style="display: flex; gap: 15px;">
                <button class="btn" onclick="location.href='display.html'">ğŸ¬ æŸ¥çœ‹å¤§å±</button>
                <button class="btn" onclick="location.href='index.html'">ğŸ“ ç”¨æˆ·æäº¤</button>
                <button class="btn btn-danger" onclick="logout()">ğŸšª é€€å‡º</button>
            </div>
        </div>
        
        <div class="container">
            <div class="sidebar">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æ€»ç¥ç¦æ•°</h3>
                        <div class="number" id="stat-total">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>å¾…å®¡æ ¸</h3>
                        <div class="number" id="stat-pending">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>å·²é€šè¿‡</h3>
                        <div class="number" id="stat-approved">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>å·²æ‹’ç»</h3>
                        <div class="number" id="stat-rejected">0</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3 style="margin-bottom: 15px;">ğŸ® å¼¹å¹•æ§åˆ¶</h3>
                    <label>å¼¹å¹•å¯†åº¦: <span id="density-value">50%</span></label>
                    <input type="range" id="density" min="10" max="100" value="50" oninput="updateDensity()">
                    
                    <label>å¼¹å¹•é€Ÿåº¦: <span id="speed-value">ä¸­é€Ÿ</span></label>
                    <input type="range" id="speed" min="5" max="20" value="12" oninput="updateSpeed()">
                    
                    <button class="btn btn-primary action-btn" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn btn-primary" onclick="approveAll()">âœ… ä¸€é”®é€šè¿‡æ‰€æœ‰</button>
                    <button class="action-btn btn-danger" onclick="deleteAllRejected()">ğŸ—‘ï¸ æ¸…ç©ºå·²æ‹’ç»</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="action-btn" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                    <button class="action-btn" onclick="importData()">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchTab('pending')">â³ å¾…å®¡æ ¸ (<span id="pending-count">0</span>)</button>
                    <button class="tab-btn" onclick="switchTab('approved')">âœ… å·²é€šè¿‡ (<span id="approved-count">0</span>)</button>
                    <button class="tab-btn" onclick="switchTab('rejected')">âŒ å·²æ‹’ç» (<span id="rejected-count">0</span>)</button>
                    <button class="tab-btn" onclick="switchTab('all')">ğŸ“‹ å…¨éƒ¨ç¥ç¦</button>
                </div>
                
                <div class="tab-content active" id="tab-pending">
                    <div class="blessing-list" id="pending-list">
                        <!-- å¾…å®¡æ ¸åˆ—è¡¨ç”±JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="tab-approved">
                    <div class="blessing-list" id="approved-list">
                        <!-- å·²é€šè¿‡åˆ—è¡¨ç”±JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="tab-rejected">
                    <div class="blessing-list" id="rejected-list">
                        <!-- å·²æ‹’ç»åˆ—è¡¨ç”±JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="tab-all">
                    <div class="blessing-list" id="all-list">
                        <!-- å…¨éƒ¨åˆ—è¡¨ç”±JSç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            STORAGE_KEY: 'blessings_wall',
            ADMIN_PASSWORD: 'admin123', // é»˜è®¤å¯†ç ï¼Œè¯·ä¿®æ”¹ï¼
            PASSWORD_KEY: 'admin_password_2025'
        };
        
        // çŠ¶æ€
        let state = {
            data: { blessings: [], settings: {} },
            currentTab: 'pending'
        };
        
        // æ£€æŸ¥å¯†ç 
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            const savedPassword = localStorage.getItem(CONFIG.PASSWORD_KEY) || CONFIG.ADMIN_PASSWORD;
            
            if (input === savedPassword) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                initAdmin();
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            }
        }
        
        // åˆå§‹åŒ–ç®¡ç†å‘˜ç•Œé¢
        function initAdmin() {
            loadData();
            updateStats();
            renderTab('pending');
            setupEventListeners();
        }
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const stored = localStorage.getItem(CONFIG.STORAGE_KEY);
            state.data = stored ? JSON.parse(stored) : { blessings: [], settings: {} };
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(state.data));
            window.dispatchEvent(new Event('storage'));
            updateStats();
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const blessings = state.data.blessings || [];
            
            const total = blessings.length;
            const pending = blessings.filter(b => b.status === 'pending').length;
            const approved = blessings.filter(b => b.status === 'approved').length;
            const rejected = blessings.filter(b => b.status === 'rejected').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-approved').textContent = approved;
            document.getElementById('stat-rejected').textContent = rejected;
            
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('approved-count').textContent = approved;
            document.getElementById('rejected-count').textContent = rejected;
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            state.currentTab = tabName;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            renderTab(tabName);
        }
        
        // æ¸²æŸ“æ ‡ç­¾é¡µå†…å®¹
        function renderTab(tabName) {
            const blessings = state.data.blessings || [];
            let filtered = [];
            
            switch(tabName) {
                case 'pending':
                    filtered = blessings.filter(b => b.status === 'pending');
                    break;
                case 'approved':
                    filtered = blessings.filter(b => b.status === 'approved');
                    break;
                case 'rejected':
                    filtered = blessings.filter(b => b.status === 'rejected');
                    break;
                case 'all':
                    filtered = blessings;
                    break;
            }
            
            const container = document.getElementById(`${tabName}-list`);
            renderBlessingList(container, filtered, tabName);
        }
        
        // æ¸²æŸ“ç¥ç¦åˆ—è¡¨
        function renderBlessingList(container, blessings, tabName) {
            container.innerHTML = '';
            
            if (blessings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“­</div>
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>è¿™é‡Œè¿˜æ²¡æœ‰ç¥ç¦</p>
                    </div>
                `;
                return;
            }
            
            blessings.forEach(blessing => {
                const item = document.createElement('div');
                item.className = 'blessing-item';
                item.id = `blessing-${blessing.id}`;
                
                const statusClass = `status-${blessing.status}`;
                const statusText = blessing.status === 'pending' ? 'å¾…å®¡æ ¸' : 
                                  blessing.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»';
                
                item.innerHTML = `
                    <div class="blessing-content">
                        <div class="blessing-text" style="color: ${blessing.color}">
                            ${blessing.text}
                        </div>
                        <div class="blessing-meta">
                            <span>ğŸ‘¤ ${blessing.username}</span>
                            <span style="margin-left: 15px;">ğŸ• ${blessing.time}</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="blessing-actions">
                        ${tabName === 'pending' ? `
                            <button class="btn btn-approve" onclick="approveBlessing('${blessing.id}')">é€šè¿‡</button>
                            <button class="btn btn-reject" onclick="rejectBlessing('${blessing.id}')">æ‹’ç»</button>
                        ` : ''}
                        ${tabName === 'approved' ? `
                            <button class="btn btn-reject" onclick="rejectBlessing('${blessing.id}')">æ’¤å›</button>
                        ` : ''}
                        ${tabName === 'rejected' ? `
                            <button class="btn btn-approve" onclick="approveBlessing('${blessing.id}')">æ¢å¤</button>
                        ` : ''}
                        <button class="btn btn-delete" onclick="deleteBlessing('${blessing.id}')">åˆ é™¤</button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // å®¡æ‰¹ç¥ç¦
        function approveBlessing(id) {
            const blessing = state.data.blessings.find(b => b.id === id);
            if (blessing) {
                blessing.status = 'approved';
                saveData();
                renderTab(state.currentTab);
            }
        }
        
        // æ‹’ç»ç¥ç¦
        function rejectBlessing(id) {
            const blessing = state.data.blessings.find(b => b.id === id);
            if (blessing) {
                blessing.status = 'rejected';
                saveData();
                renderTab(state.currentTab);
            }
        }
        
        // åˆ é™¤ç¥ç¦
        function deleteBlessing(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¥ç¦å—ï¼Ÿ')) {
                state.data.blessings = state.data.blessings.filter(b => b.id !== id);
                saveData();
                renderTab(state.currentTab);
            }
        }
        
        // ä¸€é”®é€šè¿‡æ‰€æœ‰å¾…å®¡æ ¸
        function approveAll() {
            if (confirm('ç¡®å®šè¦é€šè¿‡æ‰€æœ‰å¾…å®¡æ ¸çš„ç¥ç¦å—ï¼Ÿ')) {
                state.data.blessings.forEach(b => {
                    if (b.status === 'pending') {
                        b.status = 'approved';
                    }
                });
                saveData();
                renderTab(state.currentTab);
            }
        }
        
        // åˆ é™¤æ‰€æœ‰å·²æ‹’ç»
        function deleteAllRejected() {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰å·²æ‹’ç»çš„ç¥ç¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                state.data.blessings = state.data.blessings.filter(b => b.status !== 'rejected');
                saveData();
                renderTab(state.currentTab);
            }
        }
        
        // æ›´æ–°å¯†åº¦è®¾ç½®
        function updateDensity() {
            const value = document.getElementById('density').value;
            document.getElementById('density-value').textContent = value + '%';
            if (!state.data.settings) state.data.settings = {};
            state.data.settings.density = parseInt(value);
        }
        
        // æ›´æ–°é€Ÿåº¦è®¾ç½®
        function updateSpeed() {
            const value = document.getElementById('speed').value;
            let text = 'æ…¢é€Ÿ';
            if (value > 8) text = 'ä¸­é€Ÿ';
            if (value > 15) text = 'å¿«é€Ÿ';
            
            document.getElementById('speed-value').textContent = text;
            if (!state.data.settings) state.data.settings = {};
            state.data.settings.speed = parseInt(value);
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            saveData();
            alert('è®¾ç½®å·²ä¿å­˜å¹¶åº”ç”¨åˆ°å¼¹å¹•å¢™ï¼');
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(state.data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `blessings-wall-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function() {
                    try {
                        const importedData = JSON.parse(reader.result);
                        if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™ä¼šè¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼')) {
                            state.data = importedData;
                            saveData();
                            renderTab(state.currentTab);
                            alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                        }
                    } catch (error) {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†åå°å—ï¼Ÿ')) {
                document.getElementById('admin-content').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('password-input').value = '';
            }
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // ç›‘å¬storageäº‹ä»¶ï¼ˆå…¶ä»–é¡µé¢çš„æ›´æ–°ï¼‰
            window.addEventListener('storage', () => {
                loadData();
                updateStats();
                renderTab(state.currentTab);
            });
            
            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            if (state.data.settings) {
                if (state.data.settings.density) {
                    document.getElementById('density').value = state.data.settings.density;
                    updateDensity();
                }
                if (state.data.settings.speed) {
                    document.getElementById('speed').value = state.data.settings.speed;
                    updateSpeed();
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥URLä¸­çš„å¯†é’¥
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const adminKey = urlParams.get('key');
            const savedPassword = localStorage.getItem(CONFIG.PASSWORD_KEY) || CONFIG.ADMIN_PASSWORD;
            
            // å¦‚æœURLä¸­æœ‰æ­£ç¡®çš„å¯†é’¥ï¼Œè‡ªåŠ¨ç™»å½•
            if (adminKey === savedPassword) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                initAdmin();
            } else {
                // å¦åˆ™æ˜¾ç¤ºç™»å½•ç•Œé¢
                document.getElementById('password-input').focus();
            }
            
            // è®¾ç½®é»˜è®¤å¯†ç ï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼‰
            if (!localStorage.getItem(CONFIG.PASSWORD_KEY)) {
                localStorage.setItem(CONFIG.PASSWORD_KEY, CONFIG.ADMIN_PASSWORD);
            }
        };
    </script>
</body>
</html>