<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¦å¼¹å¹•å¢™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #000428, #004e92);
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        /* å¼¹å¹•å®¹å™¨ */
        #danmu-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* å•æ¡å¼¹å¹• */
        .danmu {
            position: absolute;
            white-space: nowrap;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            z-index: 1;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }
        
        /* æ ‡é¢˜ */
        .title {
            position: absolute;
            top: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            z-index: 10;
            animation: titleGlow 2s infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            position: absolute;
            top: 100px;
            left: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 10;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 0;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* æ–°å¼¹å¹•é€šçŸ¥ */
        .new-notice {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(46, 204, 113, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            animation: slideIn 0.3s ease;
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- æ ‡é¢˜ -->
    <div class="title">âœ¨ ç¥ç¦å¼¹å¹•å¢™ âœ¨</div>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats">
        <div class="stat-item">
            <span>ğŸ’Œ</span>
            <span>ç¥ç¦æ•°: <span id="total-count">0</span></span>
        </div>
        <div class="stat-item">
            <span>ğŸ”„</span>
            <span>æœ€åæ›´æ–°: <span id="last-update">åˆšåˆš</span></span>
        </div>
    </div>
    
    <!-- å¼¹å¹•å®¹å™¨ -->
    <div id="danmu-container"></div>
    
    <!-- ç©ºçŠ¶æ€ -->
    <div class="empty-state" id="empty-state">
        <div class="empty-icon">ğŸ’­</div>
        <div style="font-size: 24px; margin-bottom: 10px;">ç­‰å¾…ç¥ç¦ä¸­...</div>
        <div>ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡çš„ç¥ç¦å°†åœ¨è¿™é‡Œæ»šåŠ¨æ˜¾ç¤º</div>
    </div>
    
    <!-- æ–°å¼¹å¹•é€šçŸ¥ -->
    <div class="new-notice" id="new-notice"></div>

      <script>
        // GitHubé…ç½®
        const GITHUB_CONFIG = {
            USERNAME: 'xc-xiaoqiao',  // ä½ çš„GitHubç”¨æˆ·å
            REPO: 'blessings-wall',   // ä½ çš„ä»“åº“å
            BRANCH: 'main'
        };
        
        // ç¥ç¦æ•°æ®API URL
        const APPROVED_URL = `https://api.github.com/repos/${GITHUB_CONFIG.USERNAME}/${GITHUB_CONFIG.REPO}/contents/data/approved.json`;
        
        // å…¨å±€å˜é‡
        let blessings = []; // æ‰€æœ‰ç¥ç¦
        let activeDanmus = []; // å½“å‰æ´»åŠ¨çš„å¼¹å¹•
        let lastBlessingCount = 0; // ä¸Šæ¬¡çš„ç¥ç¦æ•°é‡
        let updateInterval; // æ•°æ®æ›´æ–°é—´éš”
        let isFirstLoad = true; // æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½
        
        // åˆå§‹åŒ–
        async function init() {
            // é¦–æ¬¡åŠ è½½ç¥ç¦æ•°æ®
            await loadBlessings();
            
            // å¼€å§‹å®šæ—¶æ›´æ–°æ•°æ®
            updateInterval = setInterval(loadBlessings, 5000); // æ¯5ç§’æ›´æ–°ä¸€æ¬¡
            
            console.log('å¼¹å¹•å¤§å±å·²å¯åŠ¨ï¼Œä»GitHubè·å–æ•°æ®');
        }
        
        // ä»GitHubåŠ è½½ç¥ç¦æ•°æ®
        async function loadBlessings() {
            try {
                const response = await fetch(APPROVED_URL);
                
                if (!response.ok) {
                    console.error('è·å–æ•°æ®å¤±è´¥:', response.status);
                    return;
                }
                
                const data = await response.json();
                
                if (data.content) {
                    // è§£ç base64å†…å®¹
                    const content = atob(data.content);
                    const newBlessings = JSON.parse(content);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç¥ç¦
                    if (!isFirstLoad && newBlessings.length > blessings.length) {
                        const newCount = newBlessings.length - blessings.length;
                        showNewNotice(`æ”¶åˆ° ${newCount} æ¡æ–°ç¥ç¦`);
                    }
                    
                    blessings = newBlessings;
                    
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    updateStats();
                    
                    // æ¸²æŸ“å¼¹å¹•
                    renderDanmus();
                    
                    // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                    updateLastUpdateTime();
                    
                    isFirstLoad = false;
                }
            } catch (error) {
                console.error('åŠ è½½ç¥ç¦å¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“å¼¹å¹•
        function renderDanmus() {
            const container = document.getElementById('danmu-container');
            const emptyState = document.getElementById('empty-state');
            
            // å¦‚æœæ²¡æœ‰ç¥ç¦ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (blessings.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            // éšè—ç©ºçŠ¶æ€
            emptyState.style.display = 'none';
            
            // æ¸…é™¤å·²å®Œæˆçš„å¼¹å¹•
            activeDanmus = activeDanmus.filter(danmu => {
                if (danmu.offsetLeft < -danmu.offsetWidth) {
                    danmu.remove();
                    return false;
                }
                return true;
            });
            
            // è®¡ç®—å½“å‰å¼¹å¹•æ•°é‡
            const currentCount = activeDanmus.length;
            const maxDanmus = 30; // æœ€å¤§åŒæ—¶æ˜¾ç¤ºçš„å¼¹å¹•æ•°é‡
        
            // å¦‚æœå¼¹å¹•å¤ªå°‘ï¼Œæ·»åŠ æ–°å¼¹å¹•
            if (currentCount < maxDanmus && blessings.length > 0) {
                const needToAdd = maxDanmus - currentCount;
                
                for (let i = 0; i < needToAdd && i < blessings.length; i++) {
                    // éšæœºé€‰æ‹©ä¸€æ¡ç¥ç¦
                    const randomIndex = Math.floor(Math.random() * blessings.length);
                    const blessing = blessings[randomIndex];
                    
                    // åˆ›å»ºå¼¹å¹•
                    createDanmu(blessing);
                }
            }
        }
        
        // åˆ›å»ºå•ä¸ªå¼¹å¹•
        function createDanmu(blessing) {
            const container = document.getElementById('danmu-container');
            const danmu = document.createElement('div');
            danmu.className = 'danmu';
            
            // è®¾ç½®å¼¹å¹•å†…å®¹
            const text = `${blessing.username}ï¼š${blessing.text}`;
            danmu.textContent = text;
            
            // ä½¿ç”¨ç¥ç¦ä¸­è®¾ç½®çš„é¢œè‰²æˆ–éšæœºé¢œè‰²
            const color = blessing.color || getRandomColor();
            danmu.style.color = color;
            
            // éšæœºå­—ä½“å¤§å°
            const fontSize = blessing.fontSize || (24 + Math.floor(Math.random() * 12));
            danmu.style.fontSize = `${fontSize}px`;
            
            // éšæœºå‚ç›´ä½ç½®
            const top = Math.random() * (window.innerHeight - 100) + 50;
            danmu.style.top = `${top}px`;
            
            // åˆå§‹ä½ç½®åœ¨å±å¹•å³ä¾§
            danmu.style.left = `${window.innerWidth}px`;
            
            // è®¡ç®—åŠ¨ç”»æ—¶é—´ï¼ˆæ ¹æ®æ–‡æœ¬é•¿åº¦ï¼‰
            const textLength = text.length;
            const duration = Math.max(10, Math.min(20, textLength / 5)); // 10-20ç§’
            
            // æ·»åŠ åŠ¨ç”»
            danmu.style.animation = `moveLeft ${duration}s linear`;
            
            // å¦‚æœåŠ¨ç”»æ ·å¼ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º
            if (!document.getElementById('danmu-animation')) {
                const style = document.createElement('style');
                style.id = 'danmu-animation';
                style.textContent = `
                    @keyframes moveLeft {
                        from { transform: translateX(0); }
                        to { transform: translateX(-${window.innerWidth + textLength * fontSize}px); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // æ·»åŠ åˆ°å®¹å™¨å’Œæ´»åŠ¨åˆ—è¡¨
            container.appendChild(danmu);
            activeDanmus.push(danmu);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å¼¹å¹•
            setTimeout(() => {
                if (danmu.parentNode) {
                    danmu.remove();
                    activeDanmus = activeDanmus.filter(d => d !== danmu);
                }
            }, duration * 1000);
        }
        
        // æ˜¾ç¤ºæ–°ç¥ç¦é€šçŸ¥
        function showNewNotice(message) {
            const notice = document.getElementById('new-notice');
            notice.textContent = message;
            notice.style.display = 'block';
            
            setTimeout(() => {
                notice.style.display = 'none';
            }, 3000);
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            document.getElementById('total-count').textContent = blessings.length;
        }
        
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('last-update').textContent = timeString;
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0',
                '#118AB2', '#EF476F', '#7209B7', '#3A86FF',
                '#FB5607', '#8338EC', '#FF006E', '#FFBE0B',
                '#FFD700', '#7BED9F', '#70A1FF', '#FF7F50'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´å¼¹å¹•
        window.addEventListener('resize', function() {
            // ç§»é™¤æ‰€æœ‰å¼¹å¹•
            activeDanmus.forEach(danmu => danmu.remove());
            activeDanmus = [];
            
            // é‡æ–°æ¸²æŸ“
            renderDanmus();
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = init;
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            clearInterval(updateInterval);
        });
    </script>
</body>
</html>